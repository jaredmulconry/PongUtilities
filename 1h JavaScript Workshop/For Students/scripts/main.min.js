"use strict";function CollideBallWithWalls(e,a){var n=checkBounds(ball.collider,arenaWalls);if(n.isColliding()){ball.handleCollision(resolveCollision(ball.position,n.getMinIntersection()));var i=n.intersections.find(function(e){return e.direction==HIT_LEFT||e.direction==HIT_RIGHT});if(void 0!=i)return i==HIT_RIGHT?setupGame(e,a):setupGame(e,a),!0}return!1}function CollideWithWalls(e,a){var n=checkBounds(player1.collider,arenaWalls),i=checkBounds(player2.collider,arenaWalls);CollideBallWithWalls(e,a)||(n.isColliding()&&player1.handleCollision(resolveCollision(player1.position,n.getMinIntersection())),i.isColliding()&&player2.handleCollision(resolveCollision(player2.position,i.getMinIntersection())))}function CollideBallWithPaddles(e,a){var n=checkCollision(ball,player1),i=checkCollision(ball,player2);n.isColliding()&&(ball.handleCollision(resolveCollision(ball.position,n.getMinIntersection())),ball.direction.scaleBy(1.5)),i.isColliding()&&(ball.handleCollision(resolveCollision(ball.position,i.getMinIntersection())),ball.direction.scaleBy(1.5))}function setupGame(e,a){player1=new Paddle(new Vector(32,a/2),"red",KEY_W,KEY_S),player2=new Paddle(new Vector(e-32,a/2),"blue",KEY_I,KEY_K),ball=new Ball(new Vector(.5*e,.5*a),"black",8),arenaWalls=new ScreenBounds(new Vector(e,a)),fillBackground(e,a,backgroundColor)}function updateGame(e,a,n,i){player1.update(e,a),player2.update(e,a),ball.update(e),CollideWithWalls(n,i),CollideBallWithPaddles(n,i)}function drawGame(e,a,n){clearSurface(e,a,n),player1.draw(e),player2.draw(e),ball.draw(e)}function clearSurface(e,a,n){e.clearRect(0,0,a,n)}function fillBackground(e,a,n){clearSurface(backgroundContext,e,a),backgroundContext.clearRect(0,0,e,a),backgroundContext.fillStyle=n,backgroundContext.fillRect(0,0,e,a)}function updateDeltaTime(){var e=Date.now(),a=e-previousFrameTime;return previousFrameTime=e,.001*a}function update(){var e=updateDeltaTime();updateGame(e,kb,gameSize.x,gameSize.y),kb.update(),updateRequest=window.requestAnimationFrame(update)}function draw(){drawGame(gameContext,gameSize.x,gameSize.y)}function prepare(){gameSize.set(gameCanvas.scrollWidth,gameCanvas.scrollHeight),gameCanvas.width=gameSize.x,gameCanvas.height=gameSize.y,backgroundCanvas.width=gameSize.x,backgroundCanvas.height=gameSize.y,setupGame(gameSize.x,gameSize.y)}function prepareAndRun(){prepare(),updateRequest=window.requestAnimationFrame(update)}function redraw(){draw(),window.requestAnimationFrame(redraw)}var backgroundColor="gray",KEY_W=87,KEY_S=83,KEY_I=73,KEY_K=75,player1,player2,ball,arenaWalls,previousFrameTime=Date.now(),gameCanvas=document.getElementById("GameCanvas"),gameContext=gameCanvas.getContext("2d"),backgroundCanvas=document.getElementById("BackgroundCanvas"),backgroundContext=backgroundCanvas.getContext("2d"),gameSize=new Vector;gameCanvas.addEventListener("onresize",function(){prepare()});var updateRequest,drawRequest,kb=new Keyboard;(function(){var e,a=0,n=["ms","moz","webkit","o"],i=n.length;for(e=0;e<i&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[n[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[e]+"CancelAnimationFrame"]||window[n[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,n){var i=(new Date).getTime(),l=Math.max(0,16-(i-a)),o=window.setTimeout(function(){e(i+l)},l);return a=i+l,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})})(),window.requestAnimationFrame(prepareAndRun),window.requestAnimationFrame(redraw);