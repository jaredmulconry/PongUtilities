"use strict";function setupGame(e,a){p1x=32,p1y=a/2,p2x=e-32,p2y=a/2,ballX=e/2,ballY=a/2,ballMoveX=Math.random()<.5?-1:1,ballMoveY=Math.random()<.5?-1:1,ball=new Ball(new Vector(.5*e,.5*a),"black",8)}function updateGame(e,a,r,l){p1direction=0,p2direction=0,a.getKey(KEY_W)&&(p1direction-=1),a.getKey(KEY_S)&&(p1direction+=1),a.getKey(KEY_I)&&(p2direction-=1),a.getKey(KEY_K)&&(p2direction+=1),p1y+=p1direction*paddleSpeed*e;var o=checkScreenBounds(p1x,p1y,paddleWidth,paddleHeight,r,l);collidePlayer1(resolveCollision(p1x,p1y,o)),p2y+=p2direction*paddleSpeed*e;var i=checkScreenBounds(p2x,p2y,paddleWidth,paddleHeight,r,l);collidePlayer2(resolveCollision(p2x,p2y,i)),ballX+=ballMoveX*ballSpeed*e,ballY+=ballMoveY*ballSpeed*e;var n=checkScreenBounds(ballX,ballY,2*ballRadius,2*ballRadius,r,l);collideBall(resolveCollision(ballX,ballY,n));var t=checkCollision(ballX,ballY,2*ballRadius,2*ballRadius,p1x,p1y,paddleWidth,paddleHeight);collideBall(resolveCollision(ballX,ballY,t))}function drawGame(e,a,r){fillBackground(e,a,r,backgroundColor),drawBox(e,p1x,p1y,paddleWidth,paddleHeight,p1color),drawBox(e,p2x,p2y,paddleWidth,paddleHeight,p2color),drawCircle(e,ballX,ballY,ballRadius,ballColor)}function collidePlayer1(e){p1x=e.correctedPos.x,p1y=e.correctedPos.y}function collidePlayer2(e){p2x=e.correctedPos.x,p2y=e.correctedPos.y}function collideBall(e){ballX=e.correctedPos.x,ballY=e.correctedPos.y,0!=e.correctionDir.x?ballMoveX*=-1:0!=e.correctionDir.y&&(ballMoveY*=-1)}function resolveCollision(e,a,r){var l={correctedPos:{x:e,y:a},correctionDir:{x:0,y:0}};switch(r.dir){case HIT_NONE:break;case HIT_LEFT:l.correctedPos.x+=r.overlap,l.correctionDir.x=1;break;case HIT_RIGHT:l.correctedPos.x-=r.overlap,l.correctionDir.x=-1;break;case HIT_UP:l.correctedPos.y+=r.overlap,l.correctionDir.y=1;break;case HIT_DOWN:l.correctedPos.y-=r.overlap,l.correctionDir.y=-1}return l}function checkCollision(e,a,r,l,o,i,n,t){var d=.5*r,c=.5*n,p=.5*l,u=.5*t;return calculateMinOverlap({l:e-d,r:e+d,u:a-p,d:a+p},{l:o-c,r:o+c,u:i-u,d:i+u})}function checkScreenBounds(e,a,r,l,o,i){var n=.5*r,t=.5*l;return calculateInverseMinOverlap({l:e-n,r:e+n,u:a-t,d:a+t},{l:0,r:o,u:0,d:i})}function calculateInverseMinOverlap(e,a){var r,l={dir:HIT_NONE,overlap:Number.MAX_VALUE};return e.l<a.l&&(r=a.l-e.l,r<l.overlap&&(l.overlap=r,l.dir=HIT_LEFT)),e.r>a.r&&(r=e.r-a.r,r<l.overlap&&(l.overlap=r,l.dir=HIT_RIGHT)),e.u<a.u&&(r=a.u-e.u,r<l.overlap&&(l.overlap=r,l.dir=HIT_UP)),e.d>a.d&&(r=e.d-a.d,r<l.overlap&&(l.overlap=r,l.dir=HIT_DOWN)),l}function calculateMinOverlap(e,a){var r={dir:HIT_NONE,overlap:Number.MAX_VALUE},l=e.l-a.r<0&&e.l-a.l>0,o=e.r-a.l>0&&e.r-a.r<0,i=e.u-a.d<0&&e.u-a.u>0,n=e.d-a.u>0&&e.d-a.d<0;if(l&&(n||i)||o&&(n||i)){var t=a.r-e.l;t<r.overlap&&(r.overlap=t,r.dir=HIT_LEFT);var t=e.r-a.l;t<r.overlap&&(r.overlap=t,r.dir=HIT_RIGHT);var t=a.d-e.u;t<r.overlap&&(r.overlap=t,r.dir=HIT_UP);var t=e.d-a.u;t<r.overlap&&(r.overlap=t,r.dir=HIT_DOWN)}return r}function fillBackground(e,a,r,l){e.fillStyle=l,e.fillRect(0,0,a,r)}function drawBox(e,a,r,l,o,i){e.fillStyle=i,e.fillRect(roundToInt(a-.5*l),roundToInt(r-.5*o),l,o)}function drawCircle(e,a,r,l,o){e.beginPath(),e.fillStyle=o,e.arc(roundToInt(a),roundToInt(r),l,0,2*Math.PI),e.fill()}function updateDeltaTime(){var e=Date.now(),a=e-previousFrameTime;return previousFrameTime=e,.001*a}function update(){var e=updateDeltaTime();updateGame(e,kb,gameSize.x,gameSize.y),kb.update()}function draw(){drawGame(context,gameSize.x,gameSize.y)}function prepareAndRun(){gameSize.set(canvas.scrollWidth,canvas.scrollHeight),canvas.width=gameSize.x,canvas.height=gameSize.y,setupGame(gameSize.x,gameSize.y),setInterval(update,1e3/gameFpsTarget)}function redraw(){draw(),window.requestAnimationFrame(redraw)}var gameFpsTarget=120,backgroundColor="gray",KEY_W=87,KEY_S=83,KEY_I=73,KEY_K=75,p1x,p1y,p1color="red",p1direction=0,p2x,p2y,p2color="blue",p2direction=0,paddleWidth=16,paddleHeight=64,paddleSpeed=128,ballX,ballY,ballRadius=8,ballSpeed=32,ballColor="black",ballMoveX=0,ballMoveY=0,ball,previousFrameTime=Date.now(),canvas=document.getElementById("GameCanvas"),context=canvas.getContext("2d"),gameSize=new Vector;canvas.addEventListener("onresize",function(){prepareAndRun()});var kb=new Keyboard;!function(){var e,a=0,r=["ms","moz","webkit","o"],l=r.length;for(e=0;e<l&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[r[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[r[e]+"CancelAnimationFrame"]||window[r[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,r){var l=(new Date).getTime(),o=Math.max(0,16-(l-a)),i=window.setTimeout(function(){e(l+o)},o);return a=l+o,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),window.requestAnimationFrame(prepareAndRun),window.requestAnimationFrame(redraw);